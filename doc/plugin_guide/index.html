<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>HowToCreatePluginsForOpenSpeedShop</title>
</head>
<body>
<h1 style="text-align: center;"><a class="mozTocH1"
 name="mozTocId831142"></a>Open|SpeedShop Plugin Creation Guide</h1>
<div style="text-align: center;"><big><span style="font-weight: bold;">Developer
Beta Release</span><br style="font-weight: bold;">
<span style="font-weight: bold;">November 13, 2005</span></big><br>
</div>
<br>
<h2><a class="mozTocH2" name="mozTocId259966"></a><span
 style="font-weight: bold;">Table of Contents</span><span
 style="text-decoration: underline;"></span></h2>
<ul id="mozToc">
<!--mozToc h1 1 h2 2 h3 3 h4 4 h5 5 h6 6--><li><a href="#mozTocId831142">Open|SpeedShop
Plugin Creation Guide</a>
    <ul>
      <li><a href="#mozTocId259966">Table of Contents</a></li>
      <li><a href="#mozTocId99355">Open|SpeedShop
Overview and Information Resources</a></li>
      <li><a href="#mozTocId892353">Open|SpeedShop Plugin
Overview
        </a></li>
      <li><a href="#mozTocId926177">Performance Data
Collector Plugin Information</a>
        <ul>
          <li><a href="#mozTocId50966">Identifying and Analyzing
The Performance Data Desired</a></li>
          <li><a href="#mozTocId177039">Implementing The
Collector Plugin</a>
            <ul>
              <li><a href="#mozTocId372405">Overview</a></li>
              <li><a href="#mozTocId885458">Data blobs</a></li>
              <li><a href="#mozTocId449880">Collector Runtime</a></li>
              <li><a href="#mozTocId635517">Collector Client </a></li>
            </ul>
          </li>
          <li><a href="#mozTocId715407">Example Collector Plugin</a></li>
        </ul>
      </li>
      <li><a href="#mozTocId376321">Graphical User
Interface Plugin Information
        </a>
        <ul>
          <li><a href="#mozTocId337995">Creating The
Graphical User Interface Panel</a></li>
          <li><a href="#mozTocId132913">Interfacing With
Open|SpeedShop - Tips and Example Information</a></li>
          <li><a href="#mozTocId701931">Example Graphical
User Interface Plugin</a></li>
        </ul>
      </li>
      <li><a href="#mozTocId501489">Command Line
Interface Plugin Information
        </a></li>
    </ul>
  </li>
</ul>
<br>
<h2><a class="mozTocH2" name="mozTocId99355"></a><a
 name="OpenSpeedShop_Overview_and_Information"></a>Open|SpeedShop
Overview and Information Resources</h2>
NOTE: This will be filled in with a couple overview paragraphs and
links to the other Open|SpeedShop documents.<br>
<br>
<h2><a class="mozTocH2" name="mozTocId892353"></a>Open|SpeedShop Plugin
Overview<br>
</h2>
The Open|SpeedShop performance tool is oriented toward gathering
performance data from user applications and relating that performance
data back to the application source file, function name and line
number(s).&nbsp;&nbsp;&nbsp; The data gathering, graphical user
interface displays, and the command line interface views are defined
via the Open|SpeedShop plugin mechanism.&nbsp;&nbsp; What this means is
that the code and data required to accomplish the above mentioned data
gathering, GUI control and display panels, and the CLI displays is
compiled into a dynamically loaded object called a plugin.&nbsp;&nbsp;
The Open|SpeedShop tools search a specified directory path or paths to
find the plugins and dynamically load them. &nbsp; Open|SpeedShop uses
the information inside the plugin to adjust the tools menus, internal
data structures, etc. to integrate the functionality contained in the
plugins into the tool.<br>
<br>
There are currently three separate types of Plugins that Open|SpeedShop
recognizes and dynamically integrates into the Open|SpeedShop tool
set.&nbsp; The three types of plugins are:<br>
<ul>
  <li>Performance data collector plugins<br>
  </li>
  <li>Graphical User Interface plugins</li>
  <li>Command Line Interface plugins</li>
</ul>
This document will outline each of the plugin types and give
instruction and examples of how to create and integrate plugins into
the Open|SpeedShop tools.<br>
<br>
<h2><a class="mozTocH2" name="mozTocId926177"></a>Performance Data
Collector Plugin Information</h2>
Writing a performance data collector consists of several
steps.&nbsp;&nbsp; The first action is to think about the performance
data that is to be collected.&nbsp; This action can be characterized as
identifying and analyzing the performance data desired.&nbsp; See the
section below for details associated with this action.&nbsp; Once the
performance data criteria is resolved the next action in the collector
plugin creation is the actual implementation action.&nbsp;&nbsp; See
the sections below that are associated with implementation and examples.<br>
<br>
<h3><a class="mozTocH3" name="mozTocId50966"></a><a
 name="Idenitifying_and_Analysing_The"></a>Identifying and Analyzing
The Performance Data Desired</h3>
The first step is the thought process which
identifies the performance data desired to be collected.&nbsp; In other
words, "What performance information do we want to try and
collect?".&nbsp;&nbsp; Open|SpeedShop allows the user to collect the
performance data and then map the gathered data back to the program
source function name and/or source line numbers.&nbsp;&nbsp; So, one
question to be asked before starting to write a collector plugin for
Open|SpeedShop is can the performance data desired be associated with
the program's source line and function addresses.&nbsp;&nbsp; Does the
performance data map back to the source?&nbsp;&nbsp; If so, then it is
a candidate
to be gathered by an Open|SpeedShop plugin.&nbsp;&nbsp;&nbsp; <br>
<br>
For
example, the PC Sampling experiment takes periodic samples of the
program address counter.&nbsp;&nbsp; A periodic timer is set and when
it goes off, the address of where the program is at, is
saved.&nbsp;&nbsp; This can be mapped back to the source program
because we have the address in the program, as the performance data
gathered.&nbsp;&nbsp; We can, by using debugging information, map the
address back to the program's source.&nbsp;&nbsp; <br>
<br>
Another phase of the identify and analyze step is to identify and
define the metric and parameters.&nbsp; The metric is a function of the
time intervals and the instruction address space.&nbsp;&nbsp; The
metric is the basic item of performance data that is to be gathered and
displayed by the collector plugin.&nbsp; The
parameter(s) can be thought of as the dial, selector, or knob that
controls how the data is collected.&nbsp;&nbsp; For example, the PC
Sampling experiment gathers the application's address at time intervals
across the applications running time.&nbsp; The time interval at which
each address sample is taken is the dial, selector, or knob control
how, actually when, the data is collected.&nbsp;&nbsp; The metric is
time spent in the application's functions and line numbers based on
translating the addresses that were gathered back to the source
function names and line numbers.<br>
<br>
Given that the "metric" is the performance data item desired to be
displayed and that the "parameter(s)" is the dial, selector, or knob to
control the collection of the "metric", lets examine these items in
more detail.&nbsp;&nbsp;&nbsp; <br>
<br>
<br>
<span
 style="font-weight: bold; font-style: italic; text-decoration: underline;">Key
point: If the parameter is a type that is already supported by
Open|SpeedShop, additional GUI and/or CLI plugins may not have to be
written to support the new collector plugin.<br>
<br>
</span>TBD - need more here................<span
 style="font-weight: bold; font-style: italic; text-decoration: underline;"><br>
</span><br>
<h3><a class="mozTocH3" name="mozTocId177039"></a><a
 name="Implementating_The_Collector_Plugin"></a>Implementing The
Collector Plugin</h3>
<h4><a class="mozTocH4" name="mozTocId372405"></a>Overview</h4>
This section provides a brief implementation related overview of what
is going on inside Open|SpeedShop with respect to the interactions of
the collector plugin with the other components of the tool and with the
application being analyzed.&nbsp;&nbsp; The collector plugin will cause
Open|SpeedShop to gather performance measurements that will be gathered
and stored temporarily in the victim application.&nbsp; This
performance data is sent from the victim application to the
Open|SpeedShop client when the performance data buffer fills up in the
victim application.&nbsp;&nbsp; When the Open|SpeedShop client receives
the performance data it is stored in the experiment database file.<br>
<br>
<h4><a class="mozTocH4" name="mozTocId885458"></a>Data blobs</h4>
The collector writer defines the format of the performance data being
gathered and stored in the victim application.&nbsp;&nbsp;
Open|SpeedShop uses the term, blob (binary large object), to refer to
the performance data objects being gathered and stored in the victim
application.&nbsp;&nbsp; There are design issues to consider when
defining the structure and size of the blob data:<br>
<ul>
  <li>Try not to use too much memory because the blob is contained in
the victom application.</li>
  <li>The blob should not be too small because having to send many
small blobs across the network could slow the network down.</li>
  <li>16k bytes has been found to be a reasonable size.&nbsp;&nbsp; PC
Sampling currently uses 8k bytes as the blob size.</li>
</ul>
Data blobs are specified in the XDR (External Data Representation)
language.&nbsp;&nbsp; XDR deals with endianess issues, data packing,
and other related issues.&nbsp;&nbsp; The XDR language looks like a C
structure definition and is specified in a file call
blob.x.&nbsp;&nbsp; This is what the collector plugin expects.&nbsp;
The blob.x file is fed into rpcgen which generates a ".c" file and a
".h" file.&nbsp; These files create a compilable C structure and
functions to convert the data to a C structure and back.<br>
<br>
<h4><a class="mozTocH4" name="mozTocId449880"></a>Collector Runtime</h4>
The collector runtime gathers data dependent on the type of performance
data the collector writer has decided to gather.&nbsp;&nbsp;&nbsp; The
collector runtime's purpose is to gather the data, package it, and send
it from the victim application to the Open|SpeedShop experiment
collector plugin client.&nbsp;&nbsp; Functionality that is generally
needed by collector runtime plugins includes the following:<br>
<ul>
  <li>Setting up a timer to trigger the gathering of performance data</li>
  <li>Using the PAPI overflow mechanism</li>
  <li>Obtaining a callstack entry</li>
  <li>Getting a program counter (PC) address</li>
  <li>Putting the collected data into a data blob</li>
  <li>Compressing the data to increase the bandwidth when sending to
the tool host (collector plugin client)<br>
  </li>
  <li>Sending the data to the tool host when the buffer (blob) fills up
and on program termination</li>
</ul>
There is also a set of commonly used shared functions that are bundled
into the Open|SpeedShop libopenss-runtime dynamic object.&nbsp;&nbsp;
These are functions that are used by more than one
collector.&nbsp;&nbsp; For example, some of the libunwind functionality
is contain in the libopenss-runtime dynamic object.<br>
<br>
<h4><a class="mozTocH4" name="mozTocId635517"></a>Collector Client </h4>
The client collector plugin directs the collector runtime by directly
and indirectly making calls to the collector runtime
functions.&nbsp;&nbsp;&nbsp; An example user action illustrates the
path between the client and runtime collector plugin
functionality.&nbsp;&nbsp; Suppose the user does an user interface
gesture that tells Open|SpeedShop to start
collecting.&nbsp;&nbsp;&nbsp; This triggers the user interface to call
the Open|SpeedShop framework which then accesses the start_collecting<br>
function in the client collector plugin.&nbsp;&nbsp; The client
collector plugin calls a Open|SpeedShop routine which ultimately
triggers the start collecting function in the runtime collector plugin.<br>
<br>
<h3><a class="mozTocH3" name="mozTocId715407"></a><a
 name="Example_Collector_Plugin"></a>Example Collector Plugin</h3>
<br>
<br>
<h2><a class="mozTocH2" name="mozTocId376321"></a>Graphical User
Interface Plugin Information<br>
</h2>
<br>
<h3><a class="mozTocH3" name="mozTocId337995"></a><a
 name="Creating_The_Graphical_User_Interface"></a>Creating The
Graphical User Interface Panel</h3>
<h3><a class="mozTocH3" name="mozTocId132913"></a><a
 name="Interfacing_With_OpenSpeedShop_-_Tips"></a>Interfacing With
Open|SpeedShop - Tips and Example Information</h3>
<h3><a class="mozTocH3" name="mozTocId701931"></a><a
 name="Example_Graphical_User_Interface_Plugin"></a>Example Graphical
User Interface Plugin</h3>
<br>
<br>
<br>
<h2><a class="mozTocH2" name="mozTocId501489"></a>Command Line
Interface Plugin Information<br>
</h2>
<br>
<br>
<br>
<br>
<br>
<br>
</body>
</html>
